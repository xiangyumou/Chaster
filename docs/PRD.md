# Chaster - Product Requirements Document (PRD)

## üìã 1. Product Overview

**Chaster** is a **Timelock Encryption Service**. It allows users and applications to encrypt data that can only be decrypted after a specific future time. It leverages the **drand** decentralized random beacon network to ensure trustless, mathematically guaranteed time locks.

### Type
**Self-Hosted Service** (API + Admin Console)

### Core Value Proposition
*   **Trustless**: No centralized server holds the decryption key; the "key" is generated by the drand network only at the specific future time.
*   **Service-First**: Designed as a backend service for other applications to integrate with via REST API.
*   **Production Ready**: Includes authentication, admin dashboard, logging, and docker deployment support.

---

## üéØ 2. Target Audience

1.  **Developers**: Who need a time-lock mechanism for their apps (e.g., sealed auctions, voting, digital time capsules).
2.  **Sysadmins/Self-Hosters**: Who want a personal "digital vault" for sensitivity files.
3.  **Organizations**: Who need secure delay-release mechanisms for documents.

---

## üöÄ 3. System Architecture

### 3.1 High-Level Architecture
```
[ Client Apps ] <---> [ REST API (Next.js) ] <---> [ Prisma ORM ] <---> [ Database (SQLite/Postgres) ]
                                      ^
                                      |
                            [ Admin Console (Next.js UI) ]
```

### 3.2 Core Technologies
*   **Framework**: Next.js 16 (App Router)
*   **Database**: SQLite (Default) or PostgreSQL (Supported via Prisma)
*   **Encryption**: `tlock-js` (Identity-Based Encryption using BLS12-381)
*   **Time Source**: `drand` mainnet (chained randomness)
*   **Authentication**: Bearer Token (Custom implementation)

---

## üîå 4. API Specification

The system exposes a comprehensive RESTful API at `/api/v1`.

### Authentication
*   **Method**: `Authorization: Bearer <token>`
*   **Management**: Tokens are managed via the Admin Console or CLI.

### Key Endpoints
*   `POST /api/v1/items`: Create encrypted item (text/image).
*   `GET /api/v1/items/:id`: Retrieve item (auto-decrypts if time passed).
*   `GET /api/v1/items`: List/Search items (supports metadata filtering).
*   `GET /api/v1/stats`: System statistics.
*   `POST /api/v1/items/:id/extend`: Re-encrypt to extend lock time.

*(See `docs/API_REFERENCE.md` and Swagger UI for details)*

---

## üñ•Ô∏è 5. Admin Console

The Console is a built-in React application for managing the service.

### Features
*   **Dashboard**: Visual statistics (Total items, unlocked vs locked, timeline).
*   **Item Browser**: View, filter, and delete encrypted items.
*   **Token Management**: Generate, revoke, and list API tokens.
*   **Settings**: System preference configuration.

### Security
*   The Console uses the SAME API tokens as external clients.
*   It logs in by validating the token against the `ApiToken` database table.

---

## üõ£Ô∏è 6. Roadmap & Status

### ‚úÖ Completed (v1.0)
*   Core Encryption Engine (tlock + drand)
*   REST API v1 Implementation
*   Admin Console (Dashboard, Items, Tokens)
*   Authentication System
*   Docker & Production Tooling (Logs, Backups)

### üîÆ Future (v2.0+)
*These features are planned but **not yet implemented**:*
*   **Multi-Tenancy**: Logical isolation of items per Token/User.
*   **Webhooks**: Notify external URLs when an item is unlocked.
*   **S3 Storage**: Support external object storage for large files.
*   **Public Shared Links**: Allow unauthenticated users to view specific unlocked items via a secure link.

> **Note**: The current version (v1.0) is a **single-tenant system** with no user management or multi-user support.

---

## üìä 7. Database Schema

### `Item`
Stores the encrypted payloads.
*   `id`: UUID
*   `encryptedData`: Base64 ciphertext
*   `decryptAt`: Unix timestamp (ms)
*   `metadata`: JSON (Custom client data)

### `ApiToken`
Stores access keys.
*   `token`: Unique string
*   `name`: Description
*   `isActive`: Boolean

---

## üõ°Ô∏è Security Model

1.  **Encryption**: Client-side (in theory) or Server-side. currently Server-side for convenience.
2.  **Key Management**: The server DOES NOT store decryption keys. The "key" is derived effectively from the drand signature released at time T.
3.  **Database Secrecy**: Even if the database is leaked, `encryptedData` cannot be decrypted before `decryptAt`.

---

**Version**: 1.1 (Service Architecture)
**Last Updated**: 2025-12-26
